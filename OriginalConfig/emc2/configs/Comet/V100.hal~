# Generated by stepconf at Thu Apr  9 23:04:57 2009
# If you make changes to this file, they will be
# overwritten when you run stepconf again
loadrt trivkins
loadrt [EMCMOT]EMCMOT base_period_nsec=[EMCMOT]BASE_PERIOD servo_period_nsec=[EMCMOT]SERVO_PERIOD traj_period_nsec=[EMCMOT]SERVO_PERIOD key=[EMCMOT]SHMEM_KEY num_joints=[TRAJ]AXES
loadrt probe_parport
loadrt hal_parport cfg=0x378
setp parport.0.reset-time 5000
loadrt stepgen step_type=0,0,0
#loadrt threads fp1=0 name1=fast period1=50000 name2=slow period2=1000000

#
loadusr -W hal_input -KRAL Dual 
#loadusr hal_joystick -d /dev/input/js0 -p joypad

loadrt and2 count=3 
loadrt or2 count=5 
loadrt not count=2 
loadrt debounce cfg="3 2"
addf debounce.0 base-thread
#addf debounce.1 base-thread
loadrt mux4 count=1

addf and2.0 base-thread  
addf and2.1 base-thread 
addf and2.2 base-thread 
addf or2.0 base-thread
addf or2.1 base-thread
addf or2.2 base-thread
addf not.0 base-thread

addf parport.0.read base-thread
addf stepgen.make-pulses base-thread
addf parport.0.write base-thread
addf parport.0.reset base-thread

addf stepgen.capture-position servo-thread
addf motion-command-handler servo-thread
addf motion-controller servo-thread
addf stepgen.update-freq servo-thread




setp stepgen.0.position-scale [AXIS_0]SCALE
setp stepgen.0.steplen 1
setp stepgen.0.stepspace 0
setp stepgen.0.dirhold 35000
setp stepgen.0.dirsetup 35000
setp stepgen.0.maxaccel [AXIS_0]STEPGEN_MAXACCEL
net xpos-cmd axis.0.motor-pos-cmd => stepgen.0.position-cmd
net xpos-fb stepgen.0.position-fb => axis.0.motor-pos-fb
net xstep <= stepgen.0.step
net xdir <= stepgen.0.dir
net xenable axis.0.amp-enable-out => stepgen.0.enable


setp stepgen.1.position-scale [AXIS_1]SCALE
setp stepgen.1.steplen 1
setp stepgen.1.stepspace 0
setp stepgen.1.dirhold 35000
setp stepgen.1.dirsetup 35000
setp stepgen.1.maxaccel [AXIS_1]STEPGEN_MAXACCEL
net ypos-cmd axis.1.motor-pos-cmd => stepgen.1.position-cmd
net ypos-fb stepgen.1.position-fb => axis.1.motor-pos-fb
net ystep <= stepgen.1.step
net ydir <= stepgen.1.dir
net yenable axis.1.amp-enable-out => stepgen.1.enable

setp stepgen.2.position-scale [AXIS_2]SCALE
setp stepgen.2.steplen 1
setp stepgen.2.stepspace 0
setp stepgen.2.dirhold 35000
setp stepgen.2.dirsetup 35000
setp stepgen.2.maxaccel [AXIS_2]STEPGEN_MAXACCEL
net zpos-cmd axis.2.motor-pos-cmd => stepgen.2.position-cmd
net zpos-fb stepgen.2.position-fb => axis.2.motor-pos-fb
net zstep <= stepgen.2.step
net zdir <= stepgen.2.dir
net zenable axis.2.amp-enable-out => stepgen.2.enable



setp parport.0.pin-02-out-reset 1
setp parport.0.pin-03-out-invert 1
setp parport.0.pin-04-out-reset 1
setp parport.0.pin-06-out-reset 1
setp parport.0.pin-08-out-reset 1
setp parport.0.pin-09-out-invert 1


net home-y1	<= parport.0.pin-10-in
net home-y2	<= parport.0.pin-11-in

net home-y1	and2.0.in0
net home-y2	and2.0.in1
net home-y 	and2.0.out

net home-y 	=> axis.1.home-sw-in

net home-y1-inv <= parport.0.pin-10-in-not
net home-y2-inv <= parport.0.pin-11-in-not

net ydir	not.0.in
net ydir-not	not.0.out

net ydir-not	or2.0.in0
net home-y1-inv or2.0.in1
net doh1	or2.0.out

net ydir-not	or2.1.in1
net home-y2-inv or2.1.in0
net doh2	or2.1.out	

net ystep 	and2.1.in0
net doh1	and2.1.in1
net ystep1 	and2.1.out

net ystep 	and2.2.in0
net doh2	and2.2.in1
net ystep2	and2.2.out

net xstep 	=> parport.0.pin-04-out
net xdir 	=> parport.0.pin-05-out
net ystep1 	=> parport.0.pin-02-out 
net ystep2 	=> parport.0.pin-08-out
net ydir 	=> parport.0.pin-03-out 
net ydir 	=> parport.0.pin-09-out
net zstep 	=> parport.0.pin-06-out
net zdir 	=> parport.0.pin-07-out

net home-y1 	or2.2.in0
net home-y1	or2.2.in1
net neg-limit-y or2.2.out

net neg-limit-y => axis.1.neg-lim-sw-in
#net home-y1 => axis.1.pos-lim-sw-in
#net home-y2 => axis.1.pos-lim-sw-in

setp debounce.0.delay 10

net switches-x-raw   <= parport.0.pin-13-in
net switches-x-raw => debounce.0.0.in 
net switches-x <= debounce.0.0.out
net switches-x => axis.0.home-sw-in
net switches-x	=> axis.0.neg-lim-sw-in
net switches-x	=> axis.0.pos-lim-sw-in

net switches-z-raw <= parport.0.pin-12-in
net switches-z-raw => debounce.0.1.in 
net switches-z <= debounce.0.1.out
net switches-z => axis.2.home-sw-in
net switches-z	=> axis.2.pos-lim-sw-in





net spindle-cw => parport.0.pin-01-out
net spindle-cw <= motion.spindle-forward

#setp debounce.1.delay 5

net estop-raw <= parport.0.pin-15-in-not
net estop-raw => debounce.0.2.in
net estop-ext <= debounce.0.2.out
net estop-ext => iocontrol.0.emc-enable-in



#net estop-out <= iocontrol.0.user-enable-out
#net estop-out => iocontrol.0.emc-enable-in

net estop-out <= iocontrol.0.user-enable-out


loadusr -W hal_manualtoolchange
net tool-change iocontrol.0.tool-change => hal_manualtoolchange.change
net tool-changed iocontrol.0.tool-changed <= hal_manualtoolchange.changed
net tool-number iocontrol.0.tool-prep-number => hal_manualtoolchange.number
net tool-prepare-loopback iocontrol.0.tool-prepare => iocontrol.0.tool-prepared
